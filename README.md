# ë„ë´‰êµ¬ ì˜ìœ ì•„ ë³µì§€ ë§ì¶¤í˜• AI ì±—ë´‡ (Dobong Welfare RAG Chatbot)
## "ë³µì¡í•œ í–‰ì • ìš©ì–´ ëŒ€ì‹ , ë¶€ëª¨ë‹˜ì˜ ì–¸ì–´ë¡œ ì‰½ê³  ì •í™•í•˜ê²Œ."

### ë„ë´‰êµ¬ ë‚´ ì˜ìœ ì•„(ì¥ì• /ë¹„ì¥ì• ) ê°€ì •ì— í•„ìš”í•œ ë§ì¶¤í˜• ë³µì§€ ì„œë¹„ìŠ¤ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì°¾ì•„ì£¼ëŠ” RAG(ê²€ìƒ‰ ì¦ê°• ìƒì„±) ê¸°ë°˜ AI ì±—ë´‡ ì„œë¹„ìŠ¤

## ğŸ“– ëª©ì°¨
1. í”„ë¡œì íŠ¸ ì†Œê°œ
2. í•µì‹¬ ê¸°ìˆ  ë° í•´ê²° ê³¼ì œ
3. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
4. ê¸°ìˆ  ìŠ¤íƒ
5. ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²•
6. í”„ë¡œì íŠ¸ êµ¬ì¡°


## ğŸ“Œ í”„ë¡œì íŠ¸ ì†Œê°œ
### ğŸ›‘ ë¬¸ì œì  (Problem)
    - ì •ë³´ì˜ íŒŒí¸í™”: ë³µì§€ ì •ë³´ê°€ êµ¬ì²­, ë³´ê±´ì†Œ, ë³µì§€ê´€ ë“± ì—¬ëŸ¬ ì‚¬ì´íŠ¸ì— í©ì–´ì ¸ ìˆì–´ ì°¾ê¸° ì–´ë µìŠµë‹ˆë‹¤.
    - ì–´ë ¤ìš´ ìš©ì–´: ë¶€ëª¨ë‹˜ì€ "ë§ì´ ëŠ¦ì–´ìš”"ë¼ê³  ê²€ìƒ‰í•˜ì§€ë§Œ, í–‰ì • ë¬¸ì„œëŠ” "ë°œë‹¬ì¬í™œì„œë¹„ìŠ¤"ë¼ê³  ë˜ì–´ ìˆì–´ ê²€ìƒ‰ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    - ìœ ì‚¬ ì‚¬ì—…ì˜ í˜¼ë™: 'ì¥ì•  ê²€ì‚¬(ì˜ë£Œë¹„ ì§€ì›)'ë¥¼ ì°¾ëŠ”ë° 'íŠ¹ìˆ˜êµìœ¡ ëŒ€ìƒì ì„ ì •(í•™êµ í–‰ì •)' ì •ë³´ê°€ ë‚˜ì™€ í˜¼ë€ì„ ì¤ë‹ˆë‹¤.
### âœ… í•´ê²°ì±… (Solution)
    - Notion ê¸°ë°˜ ë°ì´í„° ê´€ë¦¬: í˜„ì—… ë‹´ë‹¹ìê°€ ë…¸ì…˜ì— ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ í•™ìŠµí•©ë‹ˆë‹¤.
    - ë„ë©”ì¸ íŠ¹í™” ê²€ìƒ‰ ì—”ì§„: ë¶€ëª¨ë‹˜ì˜ êµ¬ì–´ì²´ ì§ˆë¬¸("ì§ì¹˜ë£Œ", "ê²€ì‚¬ë¹„")ì„ í–‰ì • ìš©ì–´("ì‚¬íšŒì„± í–¥ìƒ", "ì§„ë‹¨ì„œ ë°œê¸‰ë¹„")ë¡œ ìë™ ë³€í™˜í•©ë‹ˆë‹¤.
    - í•˜ì´ë¸Œë¦¬ë“œ ë­í‚¹ ì‹œìŠ¤í…œ: Pythonì˜ ì •êµí•œ ë£°(Rule)ê³¼ AIì˜ ë¬¸ë§¥ ì´í•´ ëŠ¥ë ¥ì„ ê²°í•©í•˜ì—¬ ìµœì ì˜ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.


## ğŸ’¡ í•µì‹¬ ê¸°ìˆ  ë° í•´ê²° ê³¼ì œ
### 1. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (Hybrid Search) & RAG: ë‹¨ìˆœí•œ í‚¤ì›Œë“œ ê²€ìƒ‰ì´ë‚˜ ë²¡í„° ê²€ìƒ‰ í•˜ë‚˜ë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.
    - **Supabase pgvector**ë¥¼ í™œìš©í•˜ì—¬ ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰(Semantic Search)ê³¼ í‚¤ì›Œë“œ ê²€ìƒ‰(Keyword Match)ì„ ë™ì‹œì— ìˆ˜í–‰í•©ë‹ˆë‹¤.
    - ì´ë¥¼ í†µí•´ "3ì‚´ ì•„ì´" ê°™ì€ ë¬¸ë§¥ê³¼ "ë°”ìš°ì²˜" ê°™ì€ í•µì‹¬ ë‹¨ì–´ë¥¼ ëª¨ë‘ ë†“ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
### 2. 'íŒŒì´ì¬ êµ¬ì¡°ëŒ€' & ê³„ê¸‰(Tier) ë­í‚¹ ì‹œìŠ¤í…œ: AIì˜ í™˜ê°(Hallucination)ê³¼ ë¶€ì •í™•í•œ ìš°ì„ ìˆœìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Rule-Base ë¡œì§ì„ ê²°í•©í–ˆìŠµë‹ˆë‹¤.
    - Tier 1 (ì„±ê³¨): ì§ˆë¬¸ì˜ í•µì‹¬ ì˜ë„(ì˜ˆ: "ê²€ì‚¬ë¹„ ì§€ì›", "ë‘ë¦¬í™œë™")ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë¬¸ì„œë¥¼ Python ë¡œì§ìœ¼ë¡œ ìš°ì„  ì„ ë³„.
    - Tier 2 (ì§„ê³¨): ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ë¬¸ì„œ ì„ ë³„.
    - Tier 3 (ì¼ë°˜): ë‚˜ë¨¸ì§€ ë²¡í„° ìœ ì‚¬ë„ ê¸°ë°˜ ë¬¸ì„œ.
    - íš¨ê³¼: "ì¥ì• ê²€ì‚¬" ê²€ìƒ‰ ì‹œ ì—‰ëš±í•œ í‚¤ì¦ˆì¹´í˜ê°€ 1ìˆœìœ„ë¡œ ëœ¨ëŠ” ë¬¸ì œë¥¼ ì›ì²œ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.
### 3. ë¬¸ë§¥ ì£¼ì… (Context Injection): ë‹¨ìˆœíˆ ë¬¸ì„œë¥¼ ë‚˜ì—´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, AIê°€ ë” ë‚˜ì€ íŒë‹¨ì„ í•˜ë„ë¡ íŒíŠ¸ë¥¼ ì¤ë‹ˆë‹¤.
    - Python ë¡œì§ì´ ì¤‘ìš”í•˜ë‹¤ê³  íŒë‹¨í•œ ë¬¸ì„œ ì œëª© ì•ì— â˜…(ìš°ì„ ì¶”ì²œ) íƒœê·¸ë¥¼ ë™ì ìœ¼ë¡œ ë¶€ì°©í•©ë‹ˆë‹¤.
    - LLM(Gemini)ì—ê²Œ "ì´ íƒœê·¸ê°€ ë¶™ì€ ë¬¸ì„œëŠ” ê°€ì‚°ì ì„ ì£¼ë¼"ê³  í”„ë¡¬í”„íŒ…í•˜ì—¬, Ruleì˜ ì •í™•ì„±ê³¼ AIì˜ ìœ ì—°ì„±ì„ ëª¨ë‘ í™•ë³´í–ˆìŠµë‹ˆë‹¤.
### 4. ê³ ë„í™”ëœ ì˜ë„ íŒŒì•… (Advanced Intent Classification)
    - ê²€ìƒ‰ì–´ í™•ì¥: "ì§ì¹˜ë£Œ" -> ["ì‚¬íšŒì„± í–¥ìƒ í”„ë¡œê·¸ë¨", "ê·¸ë£¹ í™œë™"] ìœ¼ë¡œ ìë™ í™•ì¥.
    - ë…¸ì´ì¦ˆ í•„í„°ë§: "ì„ ìƒë‹˜ê»˜ì„œ...", "í•˜ì…¨ëŠ”ë°..." ë“± ë¶ˆí•„ìš”í•œ ì„œìˆ ì–´ë¥¼ ì œê±°í•˜ê³  í•µì‹¬ ëª…ì‚¬ë§Œ ì¶”ì¶œ.
    - ë¸”ë™ë¦¬ìŠ¤íŠ¸ í•„í„°ë§: ì˜ë£Œì  'ê²€ì‚¬'ë¥¼ ë¬»ëŠ” ì§ˆë¬¸ì— 'í•™êµ í–‰ì • ì ˆì°¨(íŠ¹ìˆ˜êµìœ¡)'ê°€ ë‚˜ì˜¤ì§€ ì•Šë„ë¡ ê°•ë ¥í•œ ì œì™¸ ë¡œì§ ì ìš©.
### 5. ì•ˆì •ì ì¸ ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤ (Resilience)
    - Redis Queue: ì‚¬ìš©ì ìš”ì²­ì„ ë¹„ë™ê¸° íì— ë‹´ì•„ ì²˜ë¦¬í•˜ì—¬ íŠ¸ë˜í”½ í­ì£¼ ì‹œì—ë„ ì„œë²„ê°€ ë‹¤ìš´ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    - Tenacity Retry: ì™¸ë¶€ API(Gemini) í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ, ì§€ìˆ˜ ë°±ì˜¤í”„(Exponential Backoff) ë°©ì‹ìœ¼ë¡œ ìë™ ì¬ì‹œë„í•˜ì—¬ 504 Timeout ì˜¤ë¥˜ë¥¼ ê·¹ë³µí–ˆìŠµë‹ˆë‹¤.


## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
    ì½”ë“œ ìŠ¤ë‹ˆí«
    graph LR
        User[ì‚¬ìš©ì] -->|ì§ˆë¬¸ ì…ë ¥| FastAPI[FastAPI ì„œë²„]
        FastAPI -->|Job ìƒì„±| Redis[Redis Queue]
        Redis -->|Job ì²˜ë¦¬| Worker[Python Worker]
        Worker -->|1. ì˜ë„ íŒŒì•… & í™•ì¥| Utils[Utils (LLM)]
        Worker -->|2. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰| Supabase[(Supabase DB)]
        Worker -->|3. ë­í‚¹ & íŒíŠ¸ ì£¼ì…| Utils
        Utils -->|4. ìš”ì•½ & ë‹µë³€ ìƒì„±| Gemini[Google Gemini]
        Gemini -->|ìµœì¢… ë‹µë³€| Worker
        Worker -->|ê²°ê³¼ ì €ì¥| Redis
        FastAPI -->|ê²°ê³¼ ë°˜í™˜| User

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ
    ë¶„ë¥˜: Backend / ê¸°ìˆ : Python 3.10, FastAPI / ë¹„ê³ : ë¹„ë™ê¸° ì²˜ë¦¬ì— ìµœì í™”ëœ API ì„œë²„
    ë¶„ë¥˜: Database / ê¸°ìˆ : Supabase (PostgreSQL) / ë¹„ê³ : Vector Store ë° ë©”íƒ€ë°ì´í„° ì €ì¥
    ë¶„ë¥˜: Queue/Cache / ê¸°ìˆ : Redis / ë¹„ê³ : ì‘ì—… í ê´€ë¦¬ ë° ì‘ë‹µ ìºì‹±
    ë¶„ë¥˜: LLMGoogle / ê¸°ìˆ : Gemini 2.5 Flash / ë¹„ê³ : ì§ˆì˜ ë¶„ì„, ìš”ì•½, ë¦¬ë­í‚¹ (ë¹„ìš©/ì†ë„ ìµœì í™”)
    ë¶„ë¥˜: Deployment / ê¸°ìˆ : Docker, Hugging Face Spaces / ë¹„ê³ : ì»¨í…Œì´ë„ˆ ê¸°ë°˜ í´ë¼ìš°ë“œ ë°°í¬
    ë¶„ë¥˜: External / ê¸°ìˆ : Notion API / ë¹„ê³ : ë³µì§€ ë°ì´í„° ì†ŒìŠ¤ ì—°ë™


## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²•
### 1. í™˜ê²½ ì„¤ì • (.env): í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— .env íŒŒì¼ì„ ìƒì„±í•˜ê³  API Keyë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

Bash
    GEMINI_API_KEY="your_google_api_key"
    SUPABASE_URL="your_supabase_url"
    SUPABASE_KEY="your_supabase_key"
    NOTION_KEY="your_notion_key"

### 2. Docker ì‹¤í–‰ (ê¶Œì¥): Redisì™€ ì„œë²„ í™˜ê²½ì´ í†µí•©ëœ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.
    Bash
    ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰
    docker-compose up --build
    ì ‘ì† ì£¼ì†Œ: http://localhost:78603.

### 3. ë°ì´í„° ì¸ë±ì‹± (ìµœì´ˆ 1íšŒ): Notion ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ Supabaseì— ë²¡í„°í™”í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.
    Bash
    docker-compose run --rm chatbot_api python index.py


### ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°dobong-welfare-bot/
â”œâ”€â”€ main.py             # FastAPI ë©”ì¸ ì„œë²„ (ì—”ë“œí¬ì¸íŠ¸)
â”œâ”€â”€ worker.py           # ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì²˜ë¦¬ (ê²€ìƒ‰, ë­í‚¹ ë¡œì§ í•µì‹¬)
â”œâ”€â”€ utils.py            # LLM í˜¸ì¶œ, ê²€ìƒ‰ì–´ í™•ì¥, í…ìŠ¤íŠ¸ ê°€ê³µ ë“± ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ index.py            # Notion ë°ì´í„° í¬ë¡¤ë§ ë° ë²¡í„° ì„ë² ë”© (Indexer)
â”œâ”€â”€ start.sh            # Redis, Worker, Server ë™ì‹œ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ requirements.txt    # ì˜ì¡´ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡
â”œâ”€â”€ Dockerfile          # Docker ë¹Œë“œ ì„¤ì •
â””â”€â”€ static/             # í”„ë¡ íŠ¸ì—”ë“œ (HTML, CSS, JS)
    â”œâ”€â”€ index.html
    â”œâ”€â”€ style.css
    â””â”€â”€ script.js



### ğŸ“¬ ContactDeveloper: Lee Chan-young (Dobong Welfare Center for the Disabled)
Email: (bluchany1129@gmail.com)
GitHub: (https://github.com/bluchany/dobong-welfare-bot.git)

